<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø¯ÙˆÙ†Ø© INTJ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main style="padding: 40px;">
    <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h1>

    <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="login-section">
      <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
      <input type="password" id="admin-pass" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button id="login-btn">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div id="dashboard" style="display: none;">
      <section>
        <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„">
        <textarea id="summary" placeholder="Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ù„"></textarea>
        <button id="add-article-btn">Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„</button>
      </section>

      <section style="margin-top: 40px;">
        <h2>ğŸ“© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h2>
        <div id="messages-container">
          <p>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</p>
        </div>
      </section>
    </div>
  </main>

  <script type="module">
    import { db } from "./firebase-config.js";
    import { collection, addDoc, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    const ADMIN_PASSWORD = "intj123"; // â† ÙŠÙ…ÙƒÙ†ÙƒÙ ØªØºÙŠÙŠØ±Ù‡ Ù‡Ù†Ø§
    const loginSection = document.getElementById("login-section");
    const dashboard = document.getElementById("dashboard");
    const loginBtn = document.getElementById("login-btn");
    const passInput = document.getElementById("admin-pass");

    loginBtn.addEventListener("click", () => {
      if (passInput.value === ADMIN_PASSWORD) {
        loginSection.style.display = "none";
        dashboard.style.display = "block";
        loadMessages();
      } else {
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ");
      }
    });

    // Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯
    const addBtn = document.getElementById("add-article-btn");
    addBtn.addEventListener("click", async () => {
      const title = document.getElementById("title").value;
      const summary = document.getElementById("summary").value;

      if (!title || !summary) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù„Ø®Øµ.");
        return;
      }

      await addDoc(collection(db, "articles"), {
        title,
        summary,
        created_at: new Date().toISOString()
      });

      alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!");
      document.getElementById("title").value = "";
      document.getElementById("summary").value = "";
    });

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    async function loadMessages() {
      const container = document.getElementById("messages-container");
      const q = query(collection(db, "messages"), orderBy("created_at", "desc"));
      const snapshot = await getDocs(q);
      container.innerHTML = "";

      snapshot.forEach((doc) => {
        const data = doc.data();
        const msg = document.createElement("div");
        msg.style.border = "1px solid #ccc";
        msg.style.padding = "10px";
        msg.style.marginBottom = "10px";
        msg.style.background = "#f8f8f8";
        msg.innerHTML = `
          <strong>ğŸ“§ ${data.name} (${data.email})</strong>
          <p>${data.message}</p>
          <small>${new Date(data.created_at).toLocaleString("ar")}</small>
        `;
        container.appendChild(msg);
      });

      if (container.innerHTML === "") {
        container.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
      }
    }
  </script>
</body>
</html>